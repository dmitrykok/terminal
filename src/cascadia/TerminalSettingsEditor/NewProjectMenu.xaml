<!--
    Copyright (c) Microsoft Corporation. All rights reserved. Licensed under
    the MIT License. See LICENSE in the project root for license information.
-->
<Page
    x:Class="Microsoft.Terminal.Settings.Editor.NewProjectMenu"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Microsoft.Terminal.Settings.Editor"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:model="using:Microsoft.Terminal.Settings.Model"
    xmlns:mtu="using:Microsoft.Terminal.UI"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    mc:Ignorable="d">

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="CommonResources.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!--  Wrapper for NewProjectMenuEntry that adds buttons to the ListView entries  -->
            <Style x:Key="NewProjectMenuEntryControlsWrapper" TargetType="ContentControl">
                <Setter Property="IsTabStop" Value="False" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ContentControl">
                            <Grid XYFocusKeyboardNavigation="Enabled">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <!--
                                    BODGY: We want two columns of content:
                                    1. the identifier (e.g. Project name), aligned left
                                    2. the buttons (e.g. reorder, delete), aligned right
                                    There's a bug in WinUI 2 for Windows 10 where these nested columns are treated as "auto" instead
                                    of *-sized. To work around this, we can set the width of the first column's content to
                                    StandardControlMaxWidth. The first column will be clipped as necessary to make space for the second column,
                                    resulting in the desired layout.
                                -->
                                <ContentPresenter
                                    Grid.Column="0"
                                    Width="{StaticResource StandardControlMaxWidth}"
                                    Content="{TemplateBinding Content}" />
                                <StackPanel
                                    Grid.Column="1"
                                    Orientation="Horizontal"
                                    Spacing="5">
                                    <!--  Reorder: Up  -->
                                    <Button
                                        x:Uid="NewProjectMenuEntry_ReorderUp"
                                        Click="ProjectReorderEntry_Clicked"
                                        DataContext="{TemplateBinding DataContext}"
                                        Style="{StaticResource ExtraSmallButtonStyle}"
                                        Tag="Up">
                                        <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xF0AD;" />
                                    </Button>
                                    <!--  Reorder: Down  -->
                                    <Button
                                        x:Uid="NewProjectMenuEntry_ReorderDown"
                                        Click="ProjectReorderEntry_Clicked"
                                        DataContext="{TemplateBinding DataContext}"
                                        Style="{StaticResource ExtraSmallButtonStyle}"
                                        Tag="Down">
                                        <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xF0AE;" />
                                    </Button>
                                    <!--  Delete Entry  -->
                                    <Button
                                        x:Uid="NewProjectMenuEntry_Delete"
                                        Click="ProjectDeleteEntry_Clicked"
                                        DataContext="{TemplateBinding DataContext}"
                                        Style="{StaticResource DeleteExtraSmallButtonStyle}">
                                        <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xE74D;" />
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <DataTemplate x:Key="ProjectEntryTemplate" x:DataType="local:ProjectEntryViewModel">
                <ContentControl
                    AutomationProperties.Name="{x:Bind ProjectEntry.Project.Name, Mode=OneWay}"
                    DataContext="{Binding Mode=OneWay}"
                    Style="{StaticResource NewProjectMenuEntryControlsWrapper}">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <IconSourceElement
                            Width="16"
                            Height="16"
                            VerticalAlignment="Center"
                            IconSource="{x:Bind mtu:IconPathConverter.IconSourceWUX(ProjectEntry.Project.EvaluatedIcon), Mode=OneTime}" />
                        <TextBlock VerticalAlignment="Center" Text="{x:Bind ProjectEntry.Project.Name, Mode=OneWay}" />
                    </StackPanel>
                </ContentControl>
            </DataTemplate>

            <DataTemplate x:Key="ProjectActionEntryTemplate" x:DataType="local:ProjectActionEntryViewModel">
                <ContentControl
                    AutomationProperties.Name="{x:Bind DisplayText, Mode=OneWay}"
                    DataContext="{Binding Mode=OneWay}"
                    Style="{StaticResource NewProjectMenuEntryControlsWrapper}">
                    <StackPanel Orientation="Horizontal">
                        <IconSourceElement
                            Width="16"
                            Height="16"
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            IconSource="{x:Bind mtu:IconPathConverter.IconSourceWUX(Icon), Mode=OneWay}"
                            Visibility="{x:Bind mtu:Converters.StringNotEmptyToVisibility(Icon), Mode=OneWay}" />
                        <TextBlock VerticalAlignment="Center" Text="{x:Bind DisplayText, Mode=OneWay}" />
                    </StackPanel>
                </ContentControl>
            </DataTemplate>

            <DataTemplate x:Key="ProjectSeparatorEntryTemplate" x:DataType="local:ProjectSeparatorEntryViewModel">
                <ContentControl
                    x:Uid="NewProjectMenuEntry_SeparatorItem"
                    DataContext="{Binding Mode=OneWay}"
                    Style="{StaticResource NewProjectMenuEntryControlsWrapper}">
                    <TextBlock
                        x:Uid="NewProjectMenuEntry_Separator"
                        VerticalAlignment="Center"
                        FontStyle="Italic" />
                </ContentControl>
            </DataTemplate>

            <DataTemplate x:Key="FolderEntryTemplate" x:DataType="local:FolderEntryViewModel">
                <!--
                    Most of this was copied from NewProjectMenuEntryControlsWrapper.
                    We really just added the Edit button here.
                -->
                <Grid AutomationProperties.Name="{x:Bind Name, Mode=OneWay}" XYFocusKeyboardNavigation="Enabled">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <!--
                        BODGY: We want two columns of content:
                        1. the identifier (e.g. Project name), aligned left
                        2. the buttons (e.g. reorder, delete), aligned right
                        There's a bug in WinUI 2 for Windows 10 where these nested columns are treated as "auto" instead
                        of *-sized. To work around this, we can set the width of the first column's content to
                        StandardControlMaxWidth. The first column will be clipped as necessary to make space for the second column,
                        resulting in the desired layout.
                    -->
                    <StackPanel
                        Grid.Column="0"
                        Width="{StaticResource StandardControlMaxWidth}"
                        Orientation="Horizontal">
                        <IconSourceElement
                            Width="16"
                            Height="16"
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            IconSource="{x:Bind mtu:IconPathConverter.IconSourceWUX(Icon), Mode=OneWay}"
                            Visibility="{x:Bind mtu:Converters.StringNotEmptyToVisibility(Icon), Mode=OneWay}" />
                        <TextBlock VerticalAlignment="Center" Text="{x:Bind Name, Mode=OneWay}" />
                    </StackPanel>
                    <StackPanel
                        Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="5">
                        <Button
                            x:Uid="NewProjectMenuEntry_EditFolder"
                            Click="EditEntry_Clicked"
                            DataContext="{Binding Mode=OneWay}"
                            Style="{StaticResource ExtraSmallButtonStyle}">
                            <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xE70F;" />
                        </Button>
                        <Button
                            x:Uid="NewProjectMenuEntry_ReorderUp"
                            Click="ReorderEntry_Clicked"
                            DataContext="{Binding Mode=OneWay}"
                            Style="{StaticResource ExtraSmallButtonStyle}"
                            Tag="Up">
                            <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xF0AD;" />
                        </Button>
                        <Button
                            x:Uid="NewProjectMenuEntry_ReorderDown"
                            Click="ReorderEntry_Clicked"
                            DataContext="{Binding Mode=OneWay}"
                            Style="{StaticResource ExtraSmallButtonStyle}"
                            Tag="Down">
                            <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xF0AE;" />
                        </Button>
                        <Button
                            x:Uid="NewProjectMenuEntry_Delete"
                            Click="DeleteEntry_Clicked"
                            DataContext="{Binding Mode=OneWay}"
                            Style="{StaticResource DeleteExtraSmallButtonStyle}">
                            <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xE74D;" />
                        </Button>
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="ProjectMatchEntryTemplate" x:DataType="local:ProjectMatchEntryViewModel">
                <ContentControl
                    AutomationProperties.Name="{x:Bind DisplayText, Mode=OneWay}"
                    DataContext="{Binding Mode=OneWay}"
                    Style="{StaticResource NewProjectMenuEntryControlsWrapper}">
                    <TextBlock
                        VerticalAlignment="Center"
                        FontStyle="Italic"
                        Text="{x:Bind DisplayText, Mode=OneWay}" />
                </ContentControl>
            </DataTemplate>

            <DataTemplate x:Key="ProjectRemainingEntryTemplate" x:DataType="local:ProjectRemainingEntryViewModel">
                <ContentControl
                    x:Uid="NewProjectMenuEntry_ProjectRemainingItem"
                    DataContext="{Binding Mode=OneWay}"
                    Style="{StaticResource NewProjectMenuEntryControlsWrapper}">
                    <TextBlock
                        x:Uid="NewProjectMenuEntry_ProjectRemaining"
                        VerticalAlignment="Center"
                        FontStyle="Italic" />
                </ContentControl>
            </DataTemplate>

            <local:NewProjectMenuEntryTemplateSelector
                x:Key="NewProjectMenuEntryTemplateSelector"
                ProjectActionEntryTemplate="{StaticResource ProjectActionEntryTemplate}"
                ProjectEntryTemplate="{StaticResource ProjectEntryTemplate}"
                ProjectFolderEntryTemplate="{StaticResource ProjectFolderEntryTemplate}"
                ProjectMatchEntryTemplate="{StaticResource ProjectMatchEntryTemplate}"
                ProjectRemainingEntryTemplate="{StaticResource ProjectRemainingEntryTemplate}"
                ProjectSeparatorEntryTemplate="{StaticResource ProjectSeparatorEntryTemplate}" />
        </ResourceDictionary>
    </Page.Resources>

    <Grid Margin="{StaticResource SettingStackMargin}" RowSpacing="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Folder Picker Dialog: used to select a folder to move entries to  -->
        <ContentDialog
            x:Name="ProjectFolderPickerDialog"
            x:Uid="NewProjectMenu_ProjectFolderPickerDialog"
            x:Load="False"
            DefaultButton="Primary"
            Opened="ProjectFolderPickerDialog_Opened"
            PrimaryButtonClick="ProjectFolderPickerDialog_PrimaryButtonClick">
            <muxc:TreeView
                x:Name="ProjectFolderTreeView"
                ItemsSource="{x:Bind ViewModel.ProjectFolderTree, Mode=OneWay}"
                SelectedItem="{x:Bind ViewModel.CurrentProjectFolderTreeViewSelectedItem, Mode=TwoWay}"
                SelectionMode="Single">
                <muxc:TreeView.ItemTemplate>
                    <DataTemplate x:DataType="local:ProjectFolderTreeViewEntry">
                        <muxc:TreeViewItem
                            AutomationProperties.Name="{x:Bind Name, Mode=OneWay}"
                            IsExpanded="True"
                            ItemsSource="{x:Bind Children, Mode=OneWay}">
                            <StackPanel AutomationProperties.Name="{x:Bind Name, Mode=OneWay}" Orientation="Horizontal">
                                <IconSourceElement
                                    Width="16"
                                    Height="16"
                                    Margin="0,0,10,0"
                                    VerticalAlignment="Center"
                                    IconSource="{x:Bind mtu:IconPathConverter.IconSourceWUX(Icon), Mode=OneWay}"
                                    Visibility="{x:Bind mtu:Converters.StringNotEmptyToVisibility(Icon), Mode=OneWay}" />
                                <TextBlock VerticalAlignment="Center" Text="{x:Bind Name, Mode=OneWay}" />
                            </StackPanel>
                        </muxc:TreeViewItem>
                    </DataTemplate>
                </muxc:TreeView.ItemTemplate>
            </muxc:TreeView>
        </ContentDialog>

        <!--  New Tab Menu Content  -->
        <StackPanel
            Grid.Row="0"
            MaxWidth="{StaticResource StandardControlMaxWidth}"
            Spacing="10">
            <Border
                Height="300"
                MaxWidth="{StaticResource StandardControlMaxWidth}"
                Margin="0,12,0,0"
                BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                BorderThickness="1"
                CornerRadius="{ThemeResource ControlCornerRadius}">
                <ListView
                    x:Name="NewProjectMenuListView"
                    AllowDrop="True"
                    CanDragItems="True"
                    CanReorderItems="True"
                    ItemTemplateSelector="{StaticResource NewProjectMenuEntryTemplateSelector}"
                    ItemsSource="{x:Bind ViewModel.ProjectCurrentView, Mode=OneWay}"
                    SelectionMode="Multiple" />
            </Border>

            <!--  General Controls  -->
            <StackPanel Orientation="Horizontal" Spacing="10">
                <Button
                    x:Name="ProjectMoveToFolderButton"
                    Click="ProjectMoveMultiple_Click"
                    IsEnabled="False">
                    <StackPanel Orientation="Horizontal">
                        <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xE8DE;" />
                        <TextBlock x:Uid="NewProjectMenu_MoveToFolderTextBlock" Margin="10,0,0,0" />
                    </StackPanel>
                </Button>
                <Button
                    x:Name="ProjectDeleteMultipleButton"
                    Click="ProjectDeleteMultiple_Click"
                    IsEnabled="False"
                    Style="{StaticResource DeleteButtonStyle}">
                    <StackPanel Orientation="Horizontal">
                        <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xE74D;" />
                        <TextBlock x:Uid="NewProjectMenu_DeleteMultipleTextBlock" Margin="10,0,0,0" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </StackPanel>

        <!--  Folder View Controls  -->
        <StackPanel
            Grid.Row="1"
            MaxWidth="{StaticResource StandardControlMaxWidth}"
            Visibility="{x:Bind ViewModel.IsProjectFolderView, Mode=OneWay}">
            <TextBlock x:Uid="NewProjectMenu_CurrentFolderTextBlock" Style="{StaticResource TextBlockSubHeaderStyle}" />

            <!--  TODO GH #18281: Icon  -->
            <!--  Once PR #17965 merges, we can add that kind of control to set an icon  -->

            <!--  Name  -->
            <local:SettingContainer
                x:Uid="NewProjectMenu_CurrentFolderName"
                Grid.Row="0"
                CurrentValue="{x:Bind ViewModel.CurrentFolderName, Mode=OneWay}"
                Style="{StaticResource ExpanderSettingContainerStyle}">
                <TextBox Style="{StaticResource TextBoxSettingStyle}" Text="{x:Bind ViewModel.CurrentFolderName, Mode=TwoWay}" />
            </local:SettingContainer>

            <!--  Inlining  -->
            <local:SettingContainer x:Uid="NewProjectMenu_CurrentFolderInlining" Grid.Row="1">
                <ToggleSwitch IsOn="{x:Bind ViewModel.CurrentFolderInlining, Mode=TwoWay}" Style="{StaticResource ToggleSwitchInExpanderStyle}" />
            </local:SettingContainer>

            <!--  Allow Empty  -->
            <local:SettingContainer x:Uid="NewProjectMenu_CurrentFolderAllowEmpty" Grid.Row="2">
                <ToggleSwitch IsOn="{x:Bind ViewModel.CurrentFolderAllowEmpty, Mode=TwoWay}" Style="{StaticResource ToggleSwitchInExpanderStyle}" />
            </local:SettingContainer>
        </StackPanel>

        <!--  Add Entries  -->
        <StackPanel Grid.Row="2">
            <TextBlock x:Uid="NewProjectMenu_AddEntriesTextBlock" Style="{StaticResource TextBlockSubHeaderStyle}" />

            <!--  Add Project  -->
            <local:SettingContainer
                x:Uid="NewProjectMenu_AddProject"
                FontIconGlyph="&#xE756;"
                Style="{StaticResource SettingContainerWithIcon}">

                <StackPanel Orientation="Horizontal" Spacing="5">
                    <!--  Select Project to add  -->
                    <ComboBox
                        x:Name="AddProjectComboBox"
                        MinWidth="{StaticResource StandardBoxMinWidth}"
                        ItemsSource="{x:Bind ViewModel.AvailableProjects, Mode=OneWay}"
                        SelectedItem="{x:Bind ViewModel.SelectedProject, Mode=TwoWay}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate x:DataType="model:Project">
                                <Grid HorizontalAlignment="Stretch" ColumnSpacing="8">

                                    <Grid.ColumnDefinitions>
                                        <!--  icon  -->
                                        <ColumnDefinition Width="16" />
                                        <!--  Project name  -->
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <IconSourceElement
                                        Grid.Column="0"
                                        Width="16"
                                        Height="16"
                                        IconSource="{x:Bind mtu:IconPathConverter.IconSourceWUX(EvaluatedIcon), Mode=OneTime}" />

                                    <TextBlock Grid.Column="1" Text="{x:Bind Name}" />
                                </Grid>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <Button
                        x:Name="AddProjectButton"
                        x:Uid="NewProjectMenu_AddProjectButton"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Click="AddProjectButton_Clicked">
                        <Button.Content>
                            <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xE710;" />
                        </Button.Content>
                    </Button>
                </StackPanel>
            </local:SettingContainer>

            <!--  Add Separator  -->
            <local:SettingContainer
                x:Uid="NewProjectMenu_AddProjectSeparator"
                FontIconGlyph="&#xE76f;"
                Style="{StaticResource SettingContainerWithIcon}">
                <Button
                    x:Name="AddProjectSeparatorButton"
                    x:Uid="NewProjectMenu_AddSeparatorButton"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Click="AddProjectSeparatorButton_Clicked">
                    <Button.Content>
                        <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xE710;" />
                    </Button.Content>
                </Button>
            </local:SettingContainer>

            <!--  Add Folder  -->
            <local:SettingContainer
                x:Uid="NewProjectMenu_AddFolder"
                FontIconGlyph="&#xF12B;"
                Style="{StaticResource SettingContainerWithIcon}">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBox
                        x:Name="ProjectFolderNameTextBox"
                        x:Uid="NewProjectMenu_AddFolder_FolderName"
                        MinWidth="{StaticResource StandardBoxMinWidth}"
                        KeyDown="AddProjectFolderNameTextBox_KeyDown"
                        Text="{x:Bind ViewModel.AddFolderName, Mode=TwoWay}"
                        TextChanged="AddProjectFolderNameTextBox_TextChanged" />
                    <Button
                        x:Name="AddProjectFolderButton"
                        x:Uid="NewProjectMenu_AddFolderButton"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Click="AddProjectFolderButton_Clicked"
                        IsEnabled="False">
                        <Button.Content>
                            <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xE710;" />
                        </Button.Content>
                    </Button>
                </StackPanel>
            </local:SettingContainer>

            <!--  Add Project Match  -->
            <local:SettingContainer
                x:Uid="NewProjectMenu_AddProjectMatch"
                FontIconGlyph="&#xE748;"
                Style="{StaticResource ExpanderSettingContainerStyleWithIcon}">
                <StackPanel Spacing="10">
                    <HyperlinkButton x:Uid="NewProjectMenu_AddProjectMatch_Help" NavigateUri="https://learn.microsoft.com/en-us/dotnet/standard/base-types/regular-expression-language-quick-reference" />
                    <TextBox x:Uid="NewProjectMenu_AddProjectMatch_Name" Text="{x:Bind ViewModel.ProjectMatcherName, Mode=TwoWay}" />
                    <TextBox x:Uid="NewProjectMenu_AddProjectMatch_Source" Text="{x:Bind ViewModel.ProjectMatcherSource, Mode=TwoWay}" />
                    <TextBox x:Uid="NewProjectMenu_AddProjectMatch_Commandline" Text="{x:Bind ViewModel.ProjectMatcherCommandline, Mode=TwoWay}" />
                    <Button x:Name="AddProjectMatchButton" Click="AddProjectMatchButton_Clicked">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal">
                                <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xE710;" />
                                <TextBlock x:Uid="NewProjectMenu_AddProjectMatchTextBlock" Style="{StaticResource IconButtonTextBlockStyle}" />
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </StackPanel>
            </local:SettingContainer>

            <!--  Add Project Remaining  -->
            <local:SettingContainer
                x:Uid="NewProjectMenu_AddProjectRemaining"
                FontIconGlyph="&#xE902;"
                Style="{StaticResource SettingContainerWithIcon}">
                <Button
                    x:Name="AddProjectRemainingButton"
                    x:Uid="NewProjectMenu_AddProjectRemainingButton"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Click="AddProjectRemainingButton_Clicked"
                    IsEnabled="{x:Bind ViewModel.IsProjectRemainingEntryMissing, Mode=OneWay}">
                    <Button.Content>
                        <FontIcon FontSize="{StaticResource StandardIconSize}" Glyph="&#xE710;" />
                    </Button.Content>
                </Button>
            </local:SettingContainer>
        </StackPanel>
    </Grid>
</Page>
